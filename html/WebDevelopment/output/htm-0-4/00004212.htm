<html><h1 class="refsect1">LAG</h1>
<p><code>LAG</code> returns the value from an earlier time period.</p>
<p class="titleinrefsubsect"><a id="sthref163" name="sthref163"></a>Return Value</p>
<p>The same data type as the value expression</p>
<p class="titleinrefsubsect"><a id="sthref164" name="sthref164"></a>Syntax</p>
<pre xml:space="preserve" class="oac_no_warn"><span class="bold">LAG (</span>lag_args<span class="bold">) OVER (</span>lag_clause<span class="bold">)</span>
</pre>
<p><span class="bolditalic">lag_args</span>::=</p>
<pre xml:space="preserve" class="oac_no_warn">expression, offset [, {default_expression | <span class="bold">CLOSEST</span>} ]
</pre>
<p><span class="bolditalic">lag_clause</span>::=</p>
<pre xml:space="preserve" class="oac_no_warn">[ {<span class="bold">DIMENSION</span> dimension_id | <span class="bold">HIERARCHY</span> hierarchy_id} ]
[ [<span class="bold">BY</span>] { <span class="bold">LEVEL</span> 
       | <span class="bold">PARENT</span> 
       | <span class="bold">GREGORIAN</span> {<span class="bold">YEAR</span> | <span class="bold">QUARTER</span> | <span class="bold">MONTH</span> | <span class="bold">WEEK</span> | <span class="bold">DAY</span>}
       | <span class="bold">ANCESTOR AT</span> { <span class="bold">DIMENSION LEVEL</span> dim_level_id
                      | <span class="bold">HIERARCHY LEVEL</span> hier_level_id
                      }
       }
                [<span class="bold">POSITION FROM</span> {<span class="bold">BEGINNING</span> | <span class="bold">END</span>}] 
] 
</pre>
<p class="titleinrefsubsect"><a id="sthref165" name="sthref165"></a>Arguments</p>
<p class="subhead2"><a id="OLAXS249" name="OLAXS249"></a><a id="sthref166" name="sthref166"></a><span class="italic">expression</span></p>
<p>A dimensional expression whose values you want to calculate.</p>
<p class="subhead2"><a id="OLAXS250" name="OLAXS250"></a><a id="sthref167" name="sthref167"></a><span class="italic">offset</span></p>
<p>A numeric expression for the number of periods to count back from the current time period.</p>
<p class="subhead2"><a id="OLAXS251" name="OLAXS251"></a><a id="sthref168" name="sthref168"></a><span class="italic">default_expression</span></p>
<p>The value returned when <code><span class="codeinlineitalic">offset</span></code> does not identify a valid period. This clause is either an expression of any data type or the <code>CLOSEST</code> keyword for the closest match. The closest match is the first member when counting back.</p>
<p class="subhead2"><a id="OLAXS252" name="OLAXS252"></a><a id="sthref169" name="sthref169"></a><span class="italic">dimension_id</span></p>
<p>The Time dimension over which the lag is calculated.</p>
<p class="subhead2"><a id="OLAXS253" name="OLAXS253"></a><a id="sthref170" name="sthref170"></a><span class="italic">hierarchy_id</span></p>
<p>The hierarchy over which the lag is calculated. Otherwise, the default hierarchy for <code><span class="codeinlineitalic">dimension_id</span></code> is used.</p>
<p class="subhead2"><a id="OLAXS254" name="OLAXS254"></a><a id="sthref171" name="sthref171"></a><span class="italic">dim_level_id</span></p>
<p>The name of a level of <code><span class="codeinlineitalic">dimension_id</span></code>.</p>
<p class="subhead2"><a id="OLAXS255" name="OLAXS255"></a><a id="sthref172" name="sthref172"></a><span class="italic">hier_level_id</span></p>
<p>The name of a level of <code><span class="codeinlineitalic">hierarchy_id</span></code>.</p>
<p class="subhead2"><a id="OLAXS256" name="OLAXS256"></a><a id="sthref173" name="sthref173"></a>BY subclause</p>
<p>The BY subclause identifies the range of time periods used when counting the offset. Following are descriptions of the keywords:</p>
<div class="inftblinformal">
<table class="Informal" title="LAG Offset Units" summary="Offset units in LAG BY clause" dir="ltr" border="1" width="100%" frame="hsides" rules="groups" cellpadding="3" cellspacing="0">
<col width="32%" />
<col width="*" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t15">Offset Unit</th>
<th align="left" valign="bottom" id="r1c2-t15">Description</th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t15" headers="r1c1-t15"><code>LEVEL</code></td>
<td align="left" headers="r2c1-t15 r1c2-t15">The member at the same level <code><span class="codeinlineitalic">offset</span></code> periods before the current member. (Default)</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t15" headers="r1c1-t15"><code>PARENT</code></td>
<td align="left" headers="r3c1-t15 r1c2-t15">The member at the same level with the same parent <code><span class="codeinlineitalic">offset</span></code> periods before the current member.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r4c1-t15" headers="r1c1-t15"><code>GREGORIAN YEAR</code></td>
<td align="left" headers="r4c1-t15 r1c2-t15">The period at the same level with a start date exactly <code>offset</code> years before the start date of the current period.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r5c1-t15" headers="r1c1-t15"><code>GREGORIAN QUARTER</code></td>
<td align="left" headers="r5c1-t15 r1c2-t15">The period at the same level with a start date exactly <code><span class="codeinlineitalic">offset</span></code> quarters before the start date of the current period.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r6c1-t15" headers="r1c1-t15"><code>GREGORIAN MONTH</code></td>
<td align="left" headers="r6c1-t15 r1c2-t15">The period at the same level with a start date exactly <code><span class="codeinlineitalic">offset</span></code> months before the start date of the current period.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r7c1-t15" headers="r1c1-t15"><code>GREGORIAN WEEK</code></td>
<td align="left" headers="r7c1-t15 r1c2-t15">The period at the same level with a start date exactly <code><span class="codeinlineitalic">offset</span></code> weeks before the start date of the current period.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r8c1-t15" headers="r1c1-t15"><code>GREGORIAN DAY</code></td>
<td align="left" headers="r8c1-t15 r1c2-t15">The period at the same level with a start date exactly <code><span class="codeinlineitalic">offset</span></code> days before the start date of the current period.</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r9c1-t15" headers="r1c1-t15"><code>ANCESTOR</code></td>
<td align="left" headers="r9c1-t15 r1c2-t15">The period at the same level as the current period and whose ancestor is <code><span class="codeinlineitalic">offset</span></code> positions before the ancestor of the current period.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="titleinrefsubsect"><a id="sthref174" name="sthref174"></a>Example</p>
<p>This example returns the value from the prior year for each period.</p>
<p><code>LAG(UNITS_CUBE.UNITS, 1) OVER (HIERARCHY "TIME".CALENDAR ANCESTOR AT DIMENSION LEVEL "TIME".CALENDAR_YEAR)</code></p>
<div class="inftblinformal">
<table class="Informal" title="LAG Example" summary="Output from LAG example" dir="ltr" border="1" width="100%" frame="hsides" rules="groups" cellpadding="3" cellspacing="0">
<col width="*" />
<col width="33%" />
<col width="33%" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t16">Time</th>
<th align="left" valign="bottom" id="r1c2-t16">Units</th>
<th align="left" valign="bottom" id="r1c3-t16">Last Year</th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t16" headers="r1c1-t16">Q1.05</td>
<td align="left" headers="r2c1-t16 r1c2-t16">143607</td>
<td align="left" headers="r2c1-t16 r1c3-t16">146529</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t16" headers="r1c1-t16">Q2.05</td>
<td align="left" headers="r3c1-t16 r1c2-t16">138096</td>
<td align="left" headers="r3c1-t16 r1c3-t16">143070</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r4c1-t16" headers="r1c1-t16">Q3.05</td>
<td align="left" headers="r4c1-t16 r1c2-t16">138953</td>
<td align="left" headers="r4c1-t16 r1c3-t16">148292</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r5c1-t16" headers="r1c1-t16">Q4.05</td>
<td align="left" headers="r5c1-t16 r1c2-t16">145062</td>
<td align="left" headers="r5c1-t16 r1c3-t16">149528</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r6c1-t16" headers="r1c1-t16">Q1.06</td>
<td align="left" headers="r6c1-t16 r1c2-t16">146819</td>
<td align="left" headers="r6c1-t16 r1c3-t16">143607</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r7c1-t16" headers="r1c1-t16">Q2.06</td>
<td align="left" headers="r7c1-t16 r1c2-t16">145233</td>
<td align="left" headers="r7c1-t16 r1c3-t16">138096</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r8c1-t16" headers="r1c1-t16">Q3.06</td>
<td align="left" headers="r8c1-t16 r1c2-t16">143572</td>
<td align="left" headers="r8c1-t16 r1c3-t16">138953</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r9c1-t16" headers="r1c1-t16">Q4.06</td>
<td align="left" headers="r9c1-t16 r1c2-t16">149305</td>
<td align="left" headers="r9c1-t16 r1c3-t16">145062</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblinformal" -->
<p class="titleinrefsubsect"><a id="sthref175" name="sthref175"></a>Related Topics</p>
<p><a href="olap_functions013.htm#CIHFBFAF">LAG_VARIANCE</a>, <a href="olap_functions014.htm#CIHDEFDI">LAG_VARIANCE_PERCENT</a>, <a href="olap_functions015.htm#CIHGEABE">LEAD</a></p>
</div>
</html>